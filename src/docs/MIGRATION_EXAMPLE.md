# üìù Exemplo Pr√°tico de Migra√ß√£o de Componente

## Componente: P√°gina de Transa√ß√µes

Este exemplo mostra a migra√ß√£o completa de um componente Vue que lista, cria, atualiza e deleta transa√ß√µes.

---

## ‚ùå ANTES - C√≥digo Antigo

```vue
<template>
  <q-page padding>
    <!-- Lista de Transa√ß√µes -->
    <q-card>
      <q-card-section>
        <div class="text-h6">Transa√ß√µes</div>
      </q-card-section>
      
      <q-separator />
      
      <q-card-section>
        <!-- Filtros -->
        <div class="row q-gutter-md q-mb-md">
          <q-select
            v-model="filters.type"
            :options="typeOptions"
            label="Tipo"
            style="min-width: 200px"
            @update:model-value="loadTransactions"
          />
          
          <q-select
            v-model="filters.category"
            :options="categories"
            label="Categoria"
            style="min-width: 200px"
            @update:model-value="loadTransactions"
          />
        </div>
        
        <!-- Tabela -->
        <q-table
          :rows="transactions"
          :columns="columns"
          :loading="loading"
          row-key="id"
        >
          <template v-slot:body-cell-actions="props">
            <q-td :props="props">
              <q-btn
                flat
                round
                icon="edit"
                @click="editTransaction(props.row)"
              />
              <q-btn
                flat
                round
                icon="delete"
                @click="deleteTransactionConfirm(props.row.id)"
              />
            </q-td>
          </template>
        </q-table>
      </q-card-section>
    </q-card>
    
    <!-- Bot√£o adicionar -->
    <q-btn
      fab
      icon="add"
      color="primary"
      @click="showCreateDialog = true"
      style="position: fixed; bottom: 20px; right: 20px;"
    />
    
    <!-- Dialog de cria√ß√£o/edi√ß√£o -->
    <q-dialog v-model="showCreateDialog">
      <q-card style="min-width: 400px">
        <q-card-section>
          <div class="text-h6">
            {{ editingTransaction ? 'Editar' : 'Nova' }} Transa√ß√£o
          </div>
        </q-card-section>
        
        <q-card-section>
          <q-form @submit="saveTransaction">
            <q-select
              v-model="form.type"
              :options="typeOptions"
              label="Tipo *"
              required
            />
            
            <q-input
              v-model.number="form.amount"
              type="number"
              label="Valor *"
              prefix="R$"
              required
            />
            
            <q-input
              v-model="form.description"
              label="Descri√ß√£o *"
              required
            />
            
            <q-select
              v-model="form.category"
              :options="categories"
              label="Categoria *"
              required
            />
            
            <q-input
              v-model="form.date"
              type="date"
              label="Data *"
              required
            />
            
            <div class="row justify-end q-gutter-sm q-mt-md">
              <q-btn label="Cancelar" flat @click="closeDialog" />
              <q-btn label="Salvar" type="submit" color="primary" />
            </div>
          </q-form>
        </q-card-section>
      </q-card>
    </q-dialog>
  </q-page>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useQuasar } from 'quasar'
import { transactionService } from '@/services/transactionService'
import { api } from 'boot/axios'

const $q = useQuasar()

// Estado
const transactions = ref([])
const loading = ref(false)
const showCreateDialog = ref(false)
const editingTransaction = ref(null)

// Filtros
const filters = ref({
  type: null,
  category: null
})

// Formul√°rio
const form = ref({
  type: 'expense',
  amount: 0,
  description: '',
  category: '',
  date: new Date().toISOString().split('T')[0]
})

// Op√ß√µes
const typeOptions = ['income', 'expense']
const categories = transactionService.getDefaultCategories()

// Colunas da tabela
const columns = [
  { name: 'date', label: 'Data', field: 'date', sortable: true },
  { name: 'description', label: 'Descri√ß√£o', field: 'description' },
  { name: 'category', label: 'Categoria', field: 'category' },
  { name: 'type', label: 'Tipo', field: 'type' },
  { name: 'amount', label: 'Valor', field: 'amount', format: val => `R$ ${val}` },
  { name: 'actions', label: 'A√ß√µes', field: 'actions' }
]

// Carregar transa√ß√µes
async function loadTransactions() {
  try {
    loading.value = true
    
    const response = await transactionService.getTransactions({
      type: filters.value.type,
      category: filters.value.category
    })
    
    transactions.value = response
    
  } catch (error) {
    console.error('Erro ao carregar transa√ß√µes:', error)
    $q.notify({
      type: 'negative',
      message: error.message || 'Erro ao carregar transa√ß√µes'
    })
  } finally {
    loading.value = false
  }
}

// Salvar transa√ß√£o (criar ou atualizar)
async function saveTransaction() {
  try {
    if (editingTransaction.value) {
      // Atualizar
      await transactionService.updateTransaction(
        editingTransaction.value.id,
        form.value
      )
      
      $q.notify({
        type: 'positive',
        message: 'Transa√ß√£o atualizada com sucesso'
      })
    } else {
      // Criar
      await transactionService.createTransaction(form.value)
      
      $q.notify({
        type: 'positive',
        message: 'Transa√ß√£o criada com sucesso'
      })
    }
    
    closeDialog()
    loadTransactions()
    
  } catch (error) {
    console.error('Erro ao salvar transa√ß√£o:', error)
    $q.notify({
      type: 'negative',
      message: error.message || 'Erro ao salvar transa√ß√£o'
    })
  }
}

// Editar transa√ß√£o
function editTransaction(transaction) {
  editingTransaction.value = transaction
  form.value = { ...transaction }
  showCreateDialog.value = true
}

// Deletar transa√ß√£o
async function deleteTransactionConfirm(id) {
  $q.dialog({
    title: 'Confirmar Exclus√£o',
    message: 'Deseja realmente excluir esta transa√ß√£o?',
    cancel: true,
    persistent: true
  }).onOk(async () => {
    try {
      await transactionService.deleteTransaction(id)
      
      $q.notify({
        type: 'positive',
        message: 'Transa√ß√£o exclu√≠da com sucesso'
      })
      
      loadTransactions()
      
    } catch (error) {
      console.error('Erro ao deletar transa√ß√£o:', error)
      $q.notify({
        type: 'negative',
        message: error.message || 'Erro ao deletar transa√ß√£o'
      })
    }
  })
}

// Fechar dialog
function closeDialog() {
  showCreateDialog.value = false
  editingTransaction.value = null
  form.value = {
    type: 'expense',
    amount: 0,
    description: '',
    category: '',
    date: new Date().toISOString().split('T')[0]
  }
}

// Inicializa√ß√£o
onMounted(() => {
  loadTransactions()
})
</script>
```

---

## ‚úÖ DEPOIS - C√≥digo Migrado

```vue
<template>
  <!-- Template permanece EXATAMENTE o mesmo -->
  <q-page padding>
    <!-- ... mesmo conte√∫do ... -->
  </q-page>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { useQuasar } from 'quasar'
// ‚úÖ MUDAN√áA: Importar helpers da API centralizada
import {
  getTransactions,
  createTransaction,
  updateTransaction,
  deleteTransaction,
  getAllCategories
} from '@/apis/api-financial'

const $q = useQuasar()

// Estado - IGUAL
const transactions = ref([])
const loading = ref(false)
const showCreateDialog = ref(false)
const editingTransaction = ref(null)

// Filtros - IGUAL
const filters = ref({
  type: null,
  category: null
})

// Formul√°rio - IGUAL
const form = ref({
  type: 'expense',
  amount: 0,
  description: '',
  category: '',
  date: new Date().toISOString().split('T')[0]
})

// Op√ß√µes - IGUAL
const typeOptions = ['income', 'expense']
// ‚úÖ MUDAN√áA: Usar helper da API centralizada
const categories = getAllCategories()

// Colunas da tabela - IGUAL
const columns = [
  { name: 'date', label: 'Data', field: 'date', sortable: true },
  { name: 'description', label: 'Descri√ß√£o', field: 'description' },
  { name: 'category', label: 'Categoria', field: 'category' },
  { name: 'type', label: 'Tipo', field: 'type' },
  { name: 'amount', label: 'Valor', field: 'amount', format: val => `R$ ${val}` },
  { name: 'actions', label: 'A√ß√µes', field: 'actions' }
]

// ‚úÖ MUDAN√áA: Fun√ß√£o simplificada com helper centralizado
async function loadTransactions() {
  try {
    loading.value = true
    
    // Chamada direta ao helper
    transactions.value = await getTransactions({
      type: filters.value.type,
      category: filters.value.category
    })
    
  } catch (error) {
    // Erro j√° vem tratado do helper
    console.error('Erro ao carregar transa√ß√µes:', error)
    $q.notify({
      type: 'negative',
      message: error.message || 'Erro ao carregar transa√ß√µes'
    })
  } finally {
    loading.value = false
  }
}

// ‚úÖ MUDAN√áA: Salvar simplificado com helpers
async function saveTransaction() {
  try {
    if (editingTransaction.value) {
      // Chamada direta ao helper de atualiza√ß√£o
      await updateTransaction(
        editingTransaction.value.id,
        form.value
      )
      
      $q.notify({
        type: 'positive',
        message: 'Transa√ß√£o atualizada com sucesso'
      })
    } else {
      // Chamada direta ao helper de cria√ß√£o
      await createTransaction(form.value)
      
      $q.notify({
        type: 'positive',
        message: 'Transa√ß√£o criada com sucesso'
      })
    }
    
    closeDialog()
    loadTransactions()
    
  } catch (error) {
    console.error('Erro ao salvar transa√ß√£o:', error)
    $q.notify({
      type: 'negative',
      message: error.message || 'Erro ao salvar transa√ß√£o'
    })
  }
}

// Editar transa√ß√£o - IGUAL
function editTransaction(transaction) {
  editingTransaction.value = transaction
  form.value = { ...transaction }
  showCreateDialog.value = true
}

// ‚úÖ MUDAN√áA: Deletar simplificado com helper
async function deleteTransactionConfirm(id) {
  $q.dialog({
    title: 'Confirmar Exclus√£o',
    message: 'Deseja realmente excluir esta transa√ß√£o?',
    cancel: true,
    persistent: true
  }).onOk(async () => {
    try {
      // Chamada direta ao helper de exclus√£o
      await deleteTransaction(id)
      
      $q.notify({
        type: 'positive',
        message: 'Transa√ß√£o exclu√≠da com sucesso'
      })
      
      loadTransactions()
      
    } catch (error) {
      console.error('Erro ao deletar transa√ß√£o:', error)
      $q.notify({
        type: 'negative',
        message: error.message || 'Erro ao deletar transa√ß√£o'
      })
    }
  })
}

// Fechar dialog - IGUAL
function closeDialog() {
  showCreateDialog.value = false
  editingTransaction.value = null
  form.value = {
    type: 'expense',
    amount: 0,
    description: '',
    category: '',
    date: new Date().toISOString().split('T')[0]
  }
}

// Inicializa√ß√£o - IGUAL
onMounted(() => {
  loadTransactions()
})
</script>
```

---

## üìä Compara√ß√£o das Mudan√ßas

### Imports

| ANTES | DEPOIS |
|-------|--------|
| `import { transactionService } from '@/services/transactionService'` | `import { getTransactions, createTransaction, ... } from '@/apis/api-financial'` |
| `import { api } from 'boot/axios'` | ‚ùå Removido (n√£o precisa mais) |

### Chamadas de API

| Opera√ß√£o | ANTES | DEPOIS |
|----------|-------|--------|
| Listar | `transactionService.getTransactions(filters)` | `getTransactions(filters)` |
| Criar | `transactionService.createTransaction(data)` | `createTransaction(data)` |
| Atualizar | `transactionService.updateTransaction(id, data)` | `updateTransaction(id, data)` |
| Deletar | `transactionService.deleteTransaction(id)` | `deleteTransaction(id)` |
| Categorias | `transactionService.getDefaultCategories()` | `getAllCategories()` |

---

## üéØ Vantagens Observadas

### 1. **Menos C√≥digo**
- ‚úÖ Removemos 1 import (`api` do axios)
- ‚úÖ Chamadas mais diretas e sem√¢nticas
- ‚úÖ Menos aninhamento de objetos

### 2. **Melhor Autocomplete**
- ‚úÖ IDE sugere todos os helpers dispon√≠veis
- ‚úÖ Par√¢metros documentados via JSDoc
- ‚úÖ Tipos inferidos automaticamente

### 3. **Manuten√ß√£o Facilitada**
- ‚úÖ Mudan√ßa de rota? Altere apenas em `API_ROUTES`
- ‚úÖ Mudan√ßa de l√≥gica? Altere apenas o helper
- ‚úÖ Componentes n√£o precisam ser alterados

### 4. **Tratamento de Erros Consistente**
- ‚úÖ Todos os erros passam por `handleApiError`
- ‚úÖ Logs padronizados
- ‚úÖ Estrutura de erro consistente

---

## üß™ Testando a Migra√ß√£o

### 1. Teste de Funcionamento B√°sico

```bash
# Inicie o servidor de desenvolvimento
npm run dev

# Acesse a p√°gina de transa√ß√µes
# Verifique se:
# - Lista carrega normalmente
# - Filtros funcionam
# - Criar transa√ß√£o funciona
# - Editar transa√ß√£o funciona
# - Deletar transa√ß√£o funciona
```

### 2. Teste de Erro

```bash
# Pare o backend
# Tente carregar a p√°gina
# Deve mostrar: "Servidor indispon√≠vel..."
# Logs no console devem estar claros
```

### 3. Teste de Performance

```bash
# Abra o DevTools
# Aba Network
# Verifique:
# - Requests est√£o corretos
# - Payload est√° correto
# - Response est√° sendo tratado
```

---

## üìù Checklist de Migra√ß√£o Aplicado

- [x] ‚úÖ Identificadas importa√ß√µes antigas
- [x] ‚úÖ Substitu√≠das por helpers centralizados
- [x] ‚úÖ Removido import de `boot/axios`
- [x] ‚úÖ Testado cen√°rio de sucesso
- [x] ‚úÖ Testado cen√°rio de erro
- [x] ‚úÖ Verificados logs no console
- [x] ‚úÖ Template mantido intacto
- [x] ‚úÖ Funcionalidade preservada
- [x] ‚úÖ C√≥digo mais limpo e leg√≠vel

---

## üöÄ Pr√≥ximos Componentes a Migrar

1. ‚úÖ **TransactionsPage.vue** (conclu√≠do neste exemplo)
2. ‚è≥ **LoginPage.vue** - Migrar autentica√ß√£o
3. ‚è≥ **ProfilePage.vue** - Migrar perfil de usu√°rio
4. ‚è≥ **DashboardPage.vue** - Migrar estat√≠sticas
5. ‚è≥ **AdminPage.vue** - Migrar opera√ß√µes admin

---

## üí° Dicas Finais

1. **Migre um componente por vez** - N√£o tente migrar tudo de uma vez
2. **Teste ap√≥s cada migra√ß√£o** - Garanta que tudo funciona antes de seguir
3. **Commit ap√≥s sucesso** - Fa√ßa commits pequenos e frequentes
4. **Documente problemas** - Se encontrar algo incomum, documente
5. **Pe√ßa revis√£o** - Outro desenvolvedor pode pegar detalhes que voc√™ perdeu

---

**Este exemplo serve como refer√™ncia para todas as outras migra√ß√µes do projeto.**
